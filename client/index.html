<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Benthos lab allows you to edit, execute and share Benthos pipeline configurations from your browser.">
  <meta name="keywords" content="benthos lab,benthos,stream processor,go,golang">
  <meta name="author" content="Ashley Jeffs">

  <title>Benthos Lab</title>

  <link href="/css/main.css" rel="stylesheet">

  <script src="/js/wasm_exec.js"></script>
  <script src="/js/editor.js"></script>

  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />

  <script>
    const model =
// BENTHOS LAB START
{
  config: `pipeline:
  processors:
  - jmespath:
      query: '{ message: @, meta: { link_count: length(links) } }'`,
  input: '{"id":"foo","links":["https://github.com/Jeffail/benthos","https://docs.benthos.dev","https://www.benthos.dev"]}'
}
// BENTHOS LAB END
;
  </script>

</head>

<body class="sea">

  <!-- Navigation -->
  <nav class="navbar">
    <h4 class="font-weight-bold"><a href="https://www.benthos.dev" class="undecorated">Benthos Lab</a></h4>
    <div class="button-group" id="tabGroup">
      <button id="configTab" class="tab">Config</button>
      <button id="inputTab" class="tab">Input</button>
    </div>
    <div class="button-group" id="happyGroup">
      <button id="compileBtn" class="btn btn-primary">Compile</button>
      <button id="executeBtn" class="btn btn-primary">Execute</button>
    </div>
    <div class="button-group" id="shareGroup">
      <button id="shareBtn" class="btn btn-secondary">Share</button>
    </div>
    <div class="button-group" id="warningGroup">
      <button id="normaliseBtn" class="btn btn-warning">Normalise</button>
      <button id="clearOutputBtn" class="btn btn-warning">Clear Output</button>
    </div>
  </nav>

  <div id="editor"></div>
  <div id="editorOutput"></div>
  <div id="addComponentWindow">
    <select id="procSelect" name="processor-selector">
      <option value="" selected>Add processor</option>
    </select>
    <select id="cacheSelect" name="cache-selector">
      <option value="" selected>Add cache</option>
    </select>
    <select id="ratelimitSelect" name="ratelimit-selector">
      <option value="" selected>Add rate limit</option>
    </select>
  </div>

  <img class="prof-img" src="/img/prof.png"/>

  <!-- ACE Editor -->
  <script src="/vendor/ace/ace.js" type="text/javascript" charset="utf-8"></script>
  <script>
      var editor = ace.edit("editor");
      var configSession = ace.createEditSession(model.config, "ace/mode/yaml");
      configSession.setTabSize(2);

      var inputSession = ace.createEditSession(model.input, "ace/mode/text");
      inputSession.setUseWrapMode(true);

      var welcomeText =
`Welcome to the Benthos Lab, a place where you can experiment with Benthos
pipeline configurations and share them with others.

Edit your pipeline configuration as well as the input data on the left by
changing tabs. When you're ready to try your pipeline click 'Compile'.

If your config compiled successfully you can then execute it with your test data
by clicking 'Execute'. Each line of your input data will be read as a message of
a batch, in order to test with multiple batches add a blank line between each
batch. The output of your pipeline will be printed in this window.

Is your config ugly or incomplete? Click 'Normalise' to have Benthos format it.

Some components won't compile or execute within the sandbox of your browser, but
you can still normalise and share them.

`;

      var outputSession = ace.createEditSession(welcomeText, "ace/mode/text");
      outputSession.setUseWrapMode(true);

      editor.setFontSize("12pt");
      editor.setTheme("ace/theme/monokai");
      editor.setSession(configSession);
      editor.setShowPrintMargin(false);

      var editorOutput = ace.edit("editorOutput");
      editorOutput.setFontSize("12pt");
      editorOutput.setReadOnly(true);
      editorOutput.setHighlightActiveLine(false);
      editorOutput.setTheme("ace/theme/monokai");
      editorOutput.setSession(outputSession);
      editorOutput.setShowPrintMargin(false);
      editorOutput.renderer.setShowGutter(false);

      initLabControls();
  </script>
</body>

</html>
